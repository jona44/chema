<!-- templates/group/manage/partials/member_row.html -->
<tr id="member-row-{{ membership.id }}"
    data-name="{% if membership.user.profile %}{{ membership.user.profile.full_name|lower }}{% else %}{{ membership.user.email|lower }}{% endif %}"
    data-email="{{ membership.user.email|lower }}" data-role="{{ membership.role }}"
    data-status="{{ membership.status }}" class="member-row"> {# Safely access full_name for data-name #}

    <!-- Member Info -->
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="flex items-center">
            <div class="flex-shrink-0 h-10 w-10">
                {% if membership.user.profile.profile_picture %}
                <img class="h-10 w-10 rounded-full object-cover" src="{{ membership.user.profile.profile_picture.url }}"
                    alt="">
                {% elif membership.user.profile %} {# Fallback if profile exists but no picture #}
                <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">
                    <span class="text-white font-medium">{{ membership.user.email|first|upper }}</span>
                </div>
                {% endif %}
            </div>
            <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">
                    {% if membership.user.profile %}{{ membership.user.profile.full_name }}{% else %}{{
                    membership.user.email }}{% endif %}</div> {# Safely display full_name #}
                <div class="text-sm text-gray-500">{{ membership.user.email }}</div>
            </div>
        </div>
    </td>

    <!-- Role -->
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
        <span class="capitalize">{{ membership.role }}</span>
    </td>

    <!-- Status -->
    <td class="px-6 py-4 whitespace-nowrap">
        {% if membership.status == 'active' %}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
            Active
        </span>
        {% elif membership.status == 'pending' %}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
            Pending
        </span>
        {% elif membership.status == 'deceased' %}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
            Deceased
        </span>
        {% else %}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
            {{ membership.status|title }}
        </span>
        {% endif %}
    </td>

    <!-- Joined Date -->
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
        {{ membership.joined_at|date:"M d, Y" }}
    </td>

    <!-- Actions -->
    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        <button hx-get="{% url 'group_manage_member_modal' group.slug membership.id %}" hx-target="#table-modal-content"
            hx-swap="innerHTML" onclick="document.getElementById('table-modal').classList.remove('hidden')"
            class="text-blue-600 hover:text-blue-900">
            Manage
        </button>
        {% if membership.user != group.creator %}
        <button hx-post="{% url 'remove_member' group.slug membership.id %}"
            hx-confirm="Are you sure you want to remove this member?" hx-target="#member-row-{{ membership.id }}"
            hx-swap="outerHTML" class="ml-4 text-red-600 hover:text-red-900">
            Remove
        </button>
        {% endif %}
    </td>
</tr>

<!-- Note: The modal container is now in members.html -->