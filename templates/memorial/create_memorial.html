<!-- memorial/templates/memorial/create_memorial.html -->
{% extends 'base.html' %}

{% block title %}Create Memorial - {{ group.name }} - {{ block.super }}{% endblock %}

{% block content %}
    <!-- Breadcrumb -->
    <nav class="text-sm breadcrumbs mb-6">
        <ol class="list-none p-0 inline-flex">
            <li class="flex items-center">
                <a href="{% url 'group_detail' slug=group.slug %}" class="text-blue-600 hover:text-blue-700">{{ group.name }}</a>
                <span class="mx-2 text-gray-400">/</span>
            </li>
            <li class="text-gray-600">Create Memorial</li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Memorial Page</h1>
        <p class="text-gray-600">Honor their memory with a digital memorial</p>
    </div>

    <!-- Form -->
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <form method="post" enctype="multipart/form-data" class="p-8 space-y-8">
                {% csrf_token %}

                <!-- Deceased Information -->
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        Personal Information
                    </h2>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Full Name -->
                        <div class="md:col-span-2">
                            <label for="{{ form.full_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Full Name *
                            </label>
                            {{ form.full_name }}
                            {% if form.full_name.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.full_name.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Dates -->
                        <div>
                            <label for="{{ form.date_of_birth.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Date of Birth *
                            </label>
                            {{ form.date_of_birth }}
                            {% if form.date_of_birth.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.date_of_birth.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div>
                            <label for="{{ form.date_of_death.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Date of Death *
                            </label>
                            {{ form.date_of_death }}
                            {% if form.date_of_death.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.date_of_death.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Photo -->
                        <div class="md:col-span-2">
                            <label for="{{ form.photo.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Memorial Photo
                            </label>
                            {{ form.photo }}
                            {% if form.photo.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.photo.errors.0 }}</div>
                            {% endif %}
                            <p class="text-gray-500 text-sm mt-1">Upload a respectful photo to remember them by</p>
                        </div>
                    </div>
                </div>

                <!-- Cultural Information -->
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Cultural Background
                    </h2>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.cultural_background.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Cultural Background
                            </label>
                            {{ form.cultural_background }}
                            {% if form.cultural_background.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.cultural_background.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div>
                            <label for="{{ form.religious_affiliation.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Religious Affiliation
                            </label>
                            {{ form.religious_affiliation }}
                            {% if form.religious_affiliation.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.religious_affiliation.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="md:col-span-2">
                            <label for="{{ form.traditional_names.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Traditional/Clan Names
                            </label>
                            {{ form.traditional_names }}
                            {% if form.traditional_names.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.traditional_names.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Life Story -->
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        Life Story & Legacy
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label for="{{ form.biography.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Biography *
                            </label>
                            {{ form.biography }}
                            {% if form.biography.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.biography.errors.0 }}</div>
                            {% endif %}
                            <p class="text-gray-500 text-sm mt-1">Share their life story, achievements, and the impact they had on others</p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.location_of_death.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Location of Death
                                </label>
                                {{ form.location_of_death }}
                                {% if form.location_of_death.errors %}
                                    <div class="text-red-600 text-sm mt-1">{{ form.location_of_death.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.burial_location.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Burial/Resting Place
                                </label>
                                {{ form.burial_location }}
                                {% if form.burial_location.errors %}
                                    <div class="text-red-600 text-sm mt-1">{{ form.burial_location.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Funeral Information -->
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 8a4 4 0 01-8 0V7a4 4 0 014-4h4m0 0v4.01"/>
                        </svg>
                        Funeral Service Details
                    </h2>
                    
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.funeral_date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Funeral Date & Time
                                </label>
                                {{ form.funeral_date }}
                                {% if form.funeral_date.errors %}
                                    <div class="text-red-600 text-sm mt-1">{{ form.funeral_date.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.funeral_venue.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Funeral Venue
                                </label>
                                {{ form.funeral_venue }}
                                {% if form.funeral_venue.errors %}
                                    <div class="text-red-600 text-sm mt-1">{{ form.funeral_venue.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div>
                            <label for="{{ form.funeral_details.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Additional Funeral Details
                            </label>
                            {{ form.funeral_details }}
                            {% if form.funeral_details.errors %}
                                <div class="text-red-600 text-sm mt-1">{{ form.funeral_details.errors.0 }}</div>
                            {% endif %}
                            <p class="text-gray-500 text-sm mt-1">Service details, dress code, directions, contact information</p>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.031 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        Memorial Settings
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            {{ form.is_public }}
                            <div>
                                <label for="{{ form.is_public.id_for_label }}" class="text-sm font-medium text-gray-700">
                                    Make this memorial public
                                </label>
                                <p class="text-xs text-gray-500 mt-1">Allow people outside the support group to view this memorial</p>
                            </div>
                        </div>

                        <div class="flex items-start space-x-3">
                            {{ form.allow_condolences }}
                            <div>
                                <label for="{{ form.allow_condolences.id_for_label }}" class="text-sm font-medium text-gray-700">
                                    Allow condolence messages
                                </label>
                                <p class="text-xs text-gray-500 mt-1">Let community members leave condolence messages</p>
                            </div>
                        </div>

                        <div class="flex items-start space-x-3">
                            {{ form.allow_memories }}
                            <div>
                                <label for="{{ form.allow_memories.id_for_label }}" class="text-sm font-medium text-gray-700">
                                    Allow memory sharing
                                </label>
                                <p class="text-xs text-gray-500 mt-1">Let community members share memories and stories</p>
                            </div>
                        </div>

                        <div class="flex items-start space-x-3">
                            {{ form.allow_photos }}
                            <div>
                                <label for="{{ form.allow_photos.id_for_label }}" class="text-sm font-medium text-gray-700">
                                    Allow photo sharing
                                </label>
                                <p class="text-xs text-gray-500 mt-1">Let community members share photos and images</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Errors -->
                {% if form.non_field_errors %}
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-600 text-sm">{{ form.non_field_errors.0 }}</div>
                    </div>
                {% endif %}

                <!-- Action Buttons -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <a href="{% url 'group_detail' slug=group.slug %}" 
                       class="text-gray-600 hover:text-gray-800 font-medium">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        Create Memorial
                    </button>
                </div>
            </form>
        </div>

        <!-- Information Panel -->
        <div class="mt-8 bg-blue-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-blue-900 mb-3">🕯️ About Memorial Pages</h3>
            <ul class="space-y-2 text-blue-800 text-sm">
                <li class="flex items-start">
                    <span class="text-blue-600 mr-2">•</span>
                    <span>Memorial pages honor the deceased and provide a space for community remembrance</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-600 mr-2">•</span>
                    <span>Family members can be added as administrators to manage content and updates</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-600 mr-2">•</span>
                    <span>The memorial connects to your support group for Chema contributions</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-600 mr-2">•</span>
                    <span>Information can be updated later by memorial administrators</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Age calculation
        function calculateAge() {
            const birthDate = document.getElementById('{{ form.date_of_birth.id_for_label }}').value;
            const deathDate = document.getElementById('{{ form.date_of_death.id_for_label }}').value;
            
            if (birthDate && deathDate) {
                const birth = new Date(birthDate);
                const death = new Date(deathDate);
                const age = Math.floor((death - birth) / (365.25 * 24 * 60 * 60 * 1000));
                
                if (age >= 0) {
                    console.log(`Age at death: ${age} years`);
                }
            }
        }

        document.getElementById('{{ form.date_of_birth.id_for_label }}').addEventListener('change', calculateAge);
        document.getElementById('{{ form.date_of_death.id_for_label }}').addEventListener('change', calculateAge);

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const required_fields = ['{{ form.full_name.id_for_label }}', '{{ form.date_of_birth.id_for_label }}', '{{ form.date_of_death.id_for_label }}', '{{ form.biography.id_for_label }}'];
            let hasErrors = false;
            
            required_fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    hasErrors = true;
                    field.style.borderColor = '#ef4444';
                } else {
                    field.style.borderColor = '#d1d5db';
                }
            });
            
            if (hasErrors) {
                e.preventDefault();
                alert('Please fill in all required fields.');
                return false;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = 'Creating Memorial...';
            submitBtn.disabled = true;
        });
    </script>
{% endblock %}